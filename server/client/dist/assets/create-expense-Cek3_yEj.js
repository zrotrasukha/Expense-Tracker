import{r as F,b as I,d as ge,j as V,c as fe,e as k,S as be,D as J,f as te,g as Me,a as ye}from"./index-Cp9MtVCX.js";function re(r,a){if(typeof r=="function")return r(a);r!=null&&(r.current=a)}function Ve(...r){return a=>{let i=!1;const e=r.map(t=>{const s=re(t,a);return!i&&typeof s=="function"&&(i=!0),s});if(i)return()=>{for(let t=0;t<e.length;t++){const s=e[t];typeof s=="function"?s():re(r[t],null)}}}}function Se(r){const a=Ee(r),i=F.forwardRef((e,t)=>{const{children:s,...n}=e,o=F.Children.toArray(s),h=o.find(we);if(h){const c=h.props.children,d=o.map(u=>u===h?F.Children.count(c)>1?F.Children.only(null):F.isValidElement(c)?c.props.children:null:u);return I.jsx(a,{...n,ref:t,children:F.isValidElement(c)?F.cloneElement(c,void 0,d):null})}return I.jsx(a,{...n,ref:t,children:s})});return i.displayName=`${r}.Slot`,i}var Fe=Se("Slot");function Ee(r){const a=F.forwardRef((i,e)=>{const{children:t,...s}=i;if(F.isValidElement(t)){const n=Ne(t),o=Ae(s,t.props);return t.type!==F.Fragment&&(o.ref=e?Ve(e,n):n),F.cloneElement(t,o)}return F.Children.count(t)>1?F.Children.only(null):null});return a.displayName=`${r}.SlotClone`,a}var xe=Symbol("radix.slottable");function we(r){return F.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===xe}function Ae(r,a){const i={...a};for(const e in a){const t=r[e],s=a[e];/^on[A-Z]/.test(e)?t&&s?i[e]=(...o)=>{const h=s(...o);return t(...o),h}:t&&(i[e]=t):e==="style"?i[e]={...t,...s}:e==="className"&&(i[e]=[t,s].filter(Boolean).join(" "))}return{...r,...i}}function Ne(r){let a=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,i=a&&"isReactWarning"in a&&a.isReactWarning;return i?r.ref:(a=Object.getOwnPropertyDescriptor(r,"ref")?.get,i=a&&"isReactWarning"in a&&a.isReactWarning,i?r.props.ref:r.props.ref||r.ref)}const ae=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,ne=ge,ke=(r,a)=>i=>{var e;if(a?.variants==null)return ne(r,i?.class,i?.className);const{variants:t,defaultVariants:s}=a,n=Object.keys(t).map(c=>{const d=i?.[c],u=s?.[c];if(d===null)return null;const l=ae(d)||ae(u);return t[c][l]}),o=i&&Object.entries(i).reduce((c,d)=>{let[u,l]=d;return l===void 0||(c[u]=l),c},{}),h=a==null||(e=a.compoundVariants)===null||e===void 0?void 0:e.reduce((c,d)=>{let{class:u,className:l,...m}=d;return Object.entries(m).every(f=>{let[v,p]=f;return Array.isArray(p)?p.includes({...s,...o}[v]):{...s,...o}[v]===p})?[...c,u,l]:c},[]);return ne(r,n,h,i?.class,i?.className)},_e=ke("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function Te({className:r,variant:a,size:i,asChild:e=!1,...t}){const s=e?Fe:"button";return V.jsxDEV(s,{"data-slot":"button",className:fe(_e({variant:a,size:i,className:r})),...t},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/components/ui/button.tsx",lineNumber:51,columnNumber:5},this)}function oe({className:r,type:a,...i}){return V.jsxDEV("input",{type:a,"data-slot":"input",className:fe("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",r),...i},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/components/ui/input.tsx",lineNumber:7,columnNumber:5},this)}function le({field:r}){return V.jsxDEV(V.Fragment,{children:[r.state.meta.isTouched&&!r.state.meta.isValid?V.jsxDEV("em",{children:r.state.meta.errors.join(", ")},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/lib/fieldInfo.tsx",lineNumber:7,columnNumber:9},this):null,r.state.meta.isValidating?"Validating...":null]},void 0,!0,{fileName:"/home/shivang/code/ExpenseTracker/client/src/lib/fieldInfo.tsx",lineNumber:5,columnNumber:5},this)}function H(r,a){return typeof r=="function"?r(a):r}function C(r,a){return ie(a).reduce((e,t)=>{if(e===null)return null;if(typeof e<"u")return e[t]},r)}function P(r,a,i){const e=ie(a);function t(s){if(!e.length)return H(i,s);const n=e.shift();if(typeof n=="string"||typeof n=="number"&&!Array.isArray(s))return typeof s=="object"?(s===null&&(s={}),{...s,[n]:t(s[n])}):{[n]:t()};if(Array.isArray(s)&&typeof n=="number"){const o=s.slice(0,n);return[...o.length?o:new Array(n),t(s[n]),...s.slice(n+1)]}return[...new Array(n),t()]}return t(r)}function De(r,a){const i=ie(a);function e(t){if(!t)return;if(i.length===1){const n=i[0];if(Array.isArray(t)&&typeof n=="number")return t.filter((c,d)=>d!==n);const{[n]:o,...h}=t;return h}const s=i.shift();if(typeof s=="string"&&typeof t=="object")return{...t,[s]:e(t[s])};if(typeof s=="number"&&Array.isArray(t)){if(s>=t.length)return t;const n=t.slice(0,s);return[...n.length?n:new Array(s),e(t[s]),...t.slice(s+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(r)}const Ie=/^(\d+)$/gm,Oe=/\.(\d+)(?=\.)/gm,je=/^(\d+)\./gm,Ce=/\.(\d+$)/gm,Be=/\.{2,}/gm,Q="__int__",$=`${Q}$1`;function ie(r){if(Array.isArray(r))return[...r];if(typeof r!="string")throw new Error("Path must be a string.");return r.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(Ie,$).replace(Oe,`.${$}.`).replace(je,`${$}.`).replace(Ce,`.${$}`).replace(Be,".").split(".").map(a=>a.indexOf(Q)===0?parseInt(a.substring(Q.length),10):a)}function Pe(r){return!(Array.isArray(r)&&r.length===0)}function X(r,a){const{asyncDebounceMs:i}=a,{onChangeAsync:e,onBlurAsync:t,onSubmitAsync:s,onBlurAsyncDebounceMs:n,onChangeAsyncDebounceMs:o}=a.validators||{},h=i??0,c={cause:"change",validate:e,debounceMs:o??h},d={cause:"blur",validate:t,debounceMs:n??h},u={cause:"submit",validate:s,debounceMs:0},l=m=>({...m,debounceMs:0});switch(r){case"submit":return[l(c),l(d),u];case"blur":return[d];case"change":return[c];case"server":default:return[]}}function Y(r,a){const{onChange:i,onBlur:e,onSubmit:t,onMount:s}=a.validators||{},n={cause:"change",validate:i},o={cause:"blur",validate:e},h={cause:"submit",validate:t},c={cause:"mount",validate:s},d={cause:"server",validate:()=>{}};switch(r){case"mount":return[c];case"submit":return[n,o,h,d];case"server":return[d];case"blur":return[o,d];case"change":default:return[n,d]}}const ee=r=>!!r&&typeof r=="object"&&"fields"in r;function T(r,a){if(Object.is(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;if(r instanceof Map&&a instanceof Map){if(r.size!==a.size)return!1;for(const[t,s]of r)if(!a.has(t)||!Object.is(s,a.get(t)))return!1;return!0}if(r instanceof Set&&a instanceof Set){if(r.size!==a.size)return!1;for(const t of r)if(!a.has(t))return!1;return!0}const i=Object.keys(r),e=Object.keys(a);if(i.length!==e.length)return!1;for(const t of i)if(!e.includes(t)||!T(r[t],a[t]))return!1;return!0}const ue=({newFormValidatorError:r,isPreviousErrorFromFormValidator:a,previousErrorValue:i})=>r?{newErrorValue:r,newSource:"form"}:a?{newErrorValue:void 0,newSource:void 0}:i?{newErrorValue:i,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},ce=({formLevelError:r,fieldLevelError:a})=>a?{newErrorValue:a,newSource:"field"}:r?{newErrorValue:r,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function $e(r){const a=new Map;for(const i of r){const e=[...i.path??[]].map(t=>{const s=typeof t=="object"?t.key:t;return typeof s=="number"?`[${s}]`:s}).join(".").replace(/\.\[/g,"[");a.set(e,(a.get(e)??[]).concat(i))}return Object.fromEntries(a)}const de=r=>{const a=$e(r);return{form:a,fields:a}},D={validate({value:r,validationSource:a},i){const e=i["~standard"].validate(r);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return a==="field"?e.issues:de(e.issues)},async validateAsync({value:r,validationSource:a},i){const e=await i["~standard"].validate(r);if(e.issues)return a==="field"?e.issues:de(e.issues)}},me=r=>!!r&&"~standard"in r,K={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function L(r){function a(u,l,m,f){const v=e(u,l,m,f);({insert:()=>o(v,u,l),remove:()=>h(v),swap:()=>f!==void 0&&d(v,u,l,f),move:()=>f!==void 0&&c(v,u,l,f)})[m]()}function i(u,l){return`${u}[${l}]`}function e(u,l,m,f){const v=[i(u,l)];if(m==="swap")v.push(i(u,f));else if(m==="move"){const[p,g]=[Math.min(l,f),Math.max(l,f)];for(let b=p;b<=g;b++)v.push(i(u,b))}else{const p=r.getFieldValue(u),g=Array.isArray(p)?p.length:0;for(let b=l+1;b<g;b++)v.push(i(u,b))}return Object.keys(r.fieldInfo).filter(p=>v.some(g=>p.startsWith(g)))}function t(u,l){return u.replace(/\[(\d+)\]/,(m,f)=>{const v=parseInt(f,10);return`[${l==="up"?v+1:Math.max(0,v-1)}]`})}function s(u,l){(l==="up"?u:[...u].reverse()).forEach(f=>{const v=t(f.toString(),l),p=r.getFieldMeta(v);p?r.setFieldMeta(f,p):r.setFieldMeta(f,n())})}const n=()=>K,o=(u,l,m)=>{s(u,"down"),u.forEach(f=>{f.toString().startsWith(i(l,m))&&r.setFieldMeta(f,n())})},h=u=>{s(u,"up")},c=(u,l,m,f)=>{const v=new Map(Object.keys(r.fieldInfo).filter(p=>p.startsWith(i(l,m))).map(p=>[p,r.getFieldMeta(p)]));s(u,m<f?"up":"down"),Object.keys(r.fieldInfo).filter(p=>p.startsWith(i(l,f))).forEach(p=>{const g=p.replace(i(l,f),i(l,m)),b=v.get(g);b&&r.setFieldMeta(p,b)})},d=(u,l,m,f)=>{u.forEach(v=>{if(!v.toString().startsWith(i(l,m)))return;const p=v.toString().replace(i(l,m),i(l,f)),[g,b]=[r.getFieldMeta(v),r.getFieldMeta(p)];g&&r.setFieldMeta(p,g),b&&r.setFieldMeta(v,b)})};return{handleArrayFieldMetaShift:a}}function q(r){return{values:r.values??{},errorMap:r.errorMap??{},fieldMetaBase:r.fieldMetaBase??{},isSubmitted:r.isSubmitted??!1,isSubmitting:r.isSubmitting??!1,isValidating:r.isValidating??!1,submissionAttempts:r.submissionAttempts??0,isSubmitSuccessful:r.isSubmitSuccessful??!1,validationMetaMap:r.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class Le{constructor(a){var i;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var e,t;const s=this.fieldMetaDerived.mount(),n=this.store.mount(),o=()=>{s(),n()};(t=(e=this.options.listeners)==null?void 0:e.onMount)==null||t.call(e,{formApi:this});const{onMount:h}=this.options.validators||{};return h&&this.validateSync("mount"),o},this.update=e=>{var t,s;if(!e)return;const n=this.options;this.options=e;const o=!!((s=(t=e.transform)==null?void 0:t.deps)!=null&&s.some((d,u)=>d!==this.prevTransformArray[u])),h=e.defaultValues&&!T(e.defaultValues,n.defaultValues)&&!this.state.isTouched,c=!T(e.defaultState,n.defaultState)&&!this.state.isTouched;!h&&!c&&!o||k(()=>{this.baseStore.setState(()=>q(Object.assign({},this.state,c?e.defaultState:{},h?{values:e.defaultValues}:{},o?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,t)=>{const{fieldMeta:s}=this.state,n=this.resetFieldMeta(s);e&&!t?.keepDefaultValues&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var o;return q({...this.options.defaultState,values:e??this.options.defaultValues??((o=this.options.defaultState)==null?void 0:o.values),fieldMetaBase:n})})},this.validateAllFields=async e=>{const t=[];return k(()=>{Object.values(this.fieldInfo).forEach(n=>{if(!n.instance)return;const o=n.instance;t.push(Promise.resolve().then(()=>o.validate(e,{skipFormValidation:!0}))),n.instance.state.meta.isTouched||n.instance.setMeta(h=>({...h,isTouched:!0}))})}),(await Promise.all(t)).flat()},this.validateArrayFieldsStartingFrom=async(e,t,s)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null,h=[`${e}[${t}]`];for(let l=t+1;l<=(o??0);l++)h.push(`${e}[${l}]`);const c=Object.keys(this.fieldInfo).filter(l=>h.some(m=>l.startsWith(m))),d=[];return k(()=>{c.forEach(l=>{d.push(Promise.resolve().then(()=>this.validateField(l,s)))})}),(await Promise.all(d)).flat()},this.validateField=(e,t)=>{var s;const n=(s=this.fieldInfo[e])==null?void 0:s.instance;return n?(n.state.meta.isTouched||n.setMeta(o=>({...o,isTouched:!0})),n.validate(t)):[]},this.validateSync=e=>{const t=Y(e,this.options);let s=!1;const n={};return k(()=>{var o,h;for(const d of t){if(!d.validate)continue;const u=this.runValidator({validate:d.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:l,fieldErrors:m}=R(u),f=W(d.cause);for(const v of Object.keys(this.state.fieldMeta)){const p=this.getFieldMeta(v);if(!p)continue;const{errorMap:g,errorSourceMap:b}=p,y=m?.[v],{newErrorValue:E,newSource:x}=ue({newFormValidatorError:y,isPreviousErrorFromFormValidator:b?.[f]==="form",previousErrorValue:g?.[f]});x==="form"&&(n[v]={...n[v],[f]:y}),g?.[f]!==E&&this.setFieldMeta(v,w=>({...w,errorMap:{...w.errorMap,[f]:E},errorSourceMap:{...w.errorSourceMap,[f]:x}}))}((o=this.state.errorMap)==null?void 0:o[f])!==l&&this.baseStore.setState(v=>({...v,errorMap:{...v.errorMap,[f]:l}})),(l||m)&&(s=!0)}const c=W("submit");(h=this.state.errorMap)!=null&&h[c]&&e!=="submit"&&!s&&this.baseStore.setState(d=>({...d,errorMap:{...d.errorMap,[c]:void 0}}))}),{hasErrored:s,fieldsErrorMap:n}},this.validateAsync=async e=>{const t=X(e,this.options);this.state.isFormValidating||this.baseStore.setState(c=>({...c,isFormValidating:!0}));const s=[];let n;for(const c of t){if(!c.validate)continue;const d=W(c.cause),u=this.state.validationMetaMap[d];u?.lastAbortController.abort();const l=new AbortController;this.state.validationMetaMap[d]={lastAbortController:l},s.push(new Promise(async m=>{let f;try{f=await new Promise((b,y)=>{setTimeout(async()=>{if(l.signal.aborted)return b(void 0);try{b(await this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:l.signal},type:"validateAsync"}))}catch(E){y(E)}},c.debounceMs)})}catch(b){f=b}const{formError:v,fieldErrors:p}=R(f);p&&(n=n?{...n,...p}:p);const g=W(c.cause);for(const b of Object.keys(this.state.fieldMeta)){const y=this.getFieldMeta(b);if(!y)continue;const{errorMap:E,errorSourceMap:x}=y,w=n?.[b],{newErrorValue:A,newSource:_}=ue({newFormValidatorError:w,isPreviousErrorFromFormValidator:x?.[g]==="form",previousErrorValue:E?.[g]});E?.[g]!==A&&this.setFieldMeta(b,S=>({...S,errorMap:{...S.errorMap,[g]:A},errorSourceMap:{...S.errorSourceMap,[g]:_}}))}this.baseStore.setState(b=>({...b,errorMap:{...b.errorMap,[g]:v}})),m(n?{fieldErrors:n,errorMapKey:g}:void 0)}))}let o=[];const h={};if(s.length){o=await Promise.all(s);for(const c of o)if(c?.fieldErrors){const{errorMapKey:d}=c;for(const[u,l]of Object.entries(c.fieldErrors)){const f={...h[u]||{},[d]:l};h[u]=f}}}return this.baseStore.setState(c=>({...c,isFormValidating:!1})),h},this.validate=e=>{const{hasErrored:t,fieldsErrorMap:s}=this.validateSync(e);return t&&!this.options.asyncAlways?s:this.validateAsync(e)},this.getFieldValue=e=>C(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var t;return(t=this.fieldInfo)[e]||(t[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,t)=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[e]:H(t,s.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((t,s)=>{const n=s;return t[n]=K,t},{}),this.setFieldValue=(e,t,s)=>{const n=s?.dontUpdateMeta??!1;k(()=>{n||this.setFieldMeta(e,o=>({...o,isTouched:!0,isDirty:!0,errorMap:{...o?.errorMap,onMount:void 0}})),this.baseStore.setState(o=>({...o,values:P(o.values,e,t)}))})},this.deleteField=e=>{const s=[...Object.keys(this.fieldInfo).filter(n=>{const o=e.toString();return n!==o&&n.startsWith(o)}),e];this.baseStore.setState(n=>{const o={...n};return s.forEach(h=>{o.values=De(o.values,h),delete this.fieldInfo[h],delete o.fieldMetaBase[h]}),o})},this.pushFieldValue=(e,t,s)=>{this.setFieldValue(e,n=>[...Array.isArray(n)?n:[],t],s),this.validateField(e,"change")},this.insertFieldValue=async(e,t,s,n)=>{this.setFieldValue(e,o=>[...o.slice(0,t),s,...o.slice(t)],n),await this.validateField(e,"change"),L(this).handleArrayFieldMetaShift(e,t,"insert"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.replaceFieldValue=async(e,t,s,n)=>{this.setFieldValue(e,o=>o.map((h,c)=>c===t?s:h),n),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.removeFieldValue=async(e,t,s)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(e,h=>h.filter((c,d)=>d!==t),s),L(this).handleArrayFieldMetaShift(e,t,"remove"),o!==null){const h=`${e}[${o}]`;this.deleteField(h)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.swapFieldValues=(e,t,s,n)=>{this.setFieldValue(e,o=>{const h=o[t],c=o[s];return P(P(o,`${t}`,c),`${s}`,h)},n),L(this).handleArrayFieldMetaShift(e,t,"swap",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.moveFieldValues=(e,t,s,n)=>{this.setFieldValue(e,o=>{const h=[...o];return h.splice(s,0,h.splice(t,1)[0]),h},n),L(this).handleArrayFieldMetaShift(e,t,"move",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.clearFieldValues=(e,t)=>{const s=this.getFieldValue(e),n=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(e,[],t),n!==null)for(let o=0;o<=n;o++){const h=`${e}[${o}]`;this.deleteField(h)}this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(t=>({...t,fieldMetaBase:{...t.fieldMetaBase,[e]:K},values:this.options.defaultValues?P(t.values,e,C(this.options.defaultValues,e)):t.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[t,s])=>(Object.keys(s).length&&s.errors.length&&(e[t]={errors:s.errors,errorMap:s.errorMap}),e),{})}),this.parseValuesWithSchema=e=>D.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>D.validateAsync({value:this.state.values,validationSource:"form"},e),this.baseStore=new be(q({...a?.defaultState,values:a?.defaultValues??((i=a?.defaultState)==null?void 0:i.values)})),this.fieldMetaDerived=new J({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{var n,o,h;const c=s,d=e?.[0],u=t[0];let l=0;const m={};for(const f of Object.keys(u.fieldMetaBase)){const v=u.fieldMetaBase[f],p=d?.fieldMetaBase[f],g=c?.[f],b=C(u.values,f);let y=g?.errors;if(!p||v.errorMap!==p.errorMap){y=Object.values(v.errorMap??{}).filter(_=>_!==void 0);const A=(n=this.getFieldInfo(f))==null?void 0:n.instance;A&&!A.options.disableErrorFlat&&(y=y?.flat(1))}const E=!Pe(y??[]),x=!v.isDirty,w=T(b,C(this.options.defaultValues,f))||T(b,(h=(o=this.getFieldInfo(f))==null?void 0:o.instance)==null?void 0:h.options.defaultValue);if(g&&g.isPristine===x&&g.isValid===E&&g.isDefaultValue===w&&g.errors===y&&v===p){m[f]=g,l++;continue}m[f]={...v,errors:y,isPristine:x,isValid:E,isDefaultValue:w}}return Object.keys(u.fieldMetaBase).length&&c&&l===Object.keys(u.fieldMetaBase).length?c:m}}),this.store=new J({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{var n,o,h,c;const d=s,u=e?.[0],l=t[0],m=t[1],f=Object.values(m).filter(Boolean),v=f.some(M=>M.isValidating),p=f.every(M=>M.isValid),g=f.some(M=>M.isTouched),b=f.some(M=>M.isBlurred),y=f.every(M=>M.isDefaultValue),E=g&&((n=l.errorMap)==null?void 0:n.onMount),x=f.some(M=>M.isDirty),w=!x,A=!!((o=l.errorMap)!=null&&o.onMount||f.some(M=>{var N;return(N=M?.errorMap)==null?void 0:N.onMount})),_=!!v;let S=d?.errors??[];(!u||l.errorMap!==u.errorMap)&&(S=Object.values(l.errorMap).reduce((M,N)=>N===void 0?M:N&&ee(N)?(M.push(N.form),M):(M.push(N),M),[]));const O=S.length===0,j=p&&O,pe=this.options.canSubmitWhenInvalid??!1,se=l.submissionAttempts===0&&!g&&!A||!_&&!l.isSubmitting&&j||pe;let B=l.errorMap;if(E&&(S=S.filter(M=>M!==l.errorMap.onMount),B=Object.assign(B,{onMount:void 0})),d&&u&&d.errorMap===B&&d.fieldMeta===this.fieldMetaDerived.state&&d.errors===S&&d.isFieldsValidating===v&&d.isFieldsValid===p&&d.isFormValid===O&&d.isValid===j&&d.canSubmit===se&&d.isTouched===g&&d.isBlurred===b&&d.isPristine===w&&d.isDefaultValue===y&&d.isDirty===x&&T(u,l))return d;let G={...l,errorMap:B,fieldMeta:this.fieldMetaDerived.state,errors:S,isFieldsValidating:v,isFieldsValid:p,isFormValid:O,isValid:j,canSubmit:se,isTouched:g,isBlurred:b,isPristine:w,isDefaultValue:y,isDirty:x};const Z=((h=this.options.transform)==null?void 0:h.deps)??[];if(Z.length!==this.prevTransformArray.length||Z.some((M,N)=>M!==this.prevTransformArray[N])){const M=Object.assign({},this,{state:G});(c=this.options.transform)==null||c.fn(M),G=M.state,this.prevTransformArray=Z}return G}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(a||{})}get state(){return this.store.state}runValidator(a){return me(a.validate)?D[a.type](a.value,a.validate):a.validate(a.value)}async handleSubmit(a){var i,e,t,s,n,o,h,c;if(this.baseStore.setState(u=>({...u,isSubmitted:!1,submissionAttempts:u.submissionAttempts+1,isSubmitSuccessful:!1})),k(()=>{Object.values(this.fieldInfo).forEach(u=>{u.instance&&(u.instance.state.meta.isTouched||u.instance.setMeta(l=>({...l,isTouched:!0})))})}),!this.state.canSubmit)return;this.baseStore.setState(u=>({...u,isSubmitting:!0}));const d=()=>{this.baseStore.setState(u=>({...u,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){d(),(e=(i=this.options).onSubmitInvalid)==null||e.call(i,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){d(),(s=(t=this.options).onSubmitInvalid)==null||s.call(t,{value:this.state.values,formApi:this});return}k(()=>{Object.values(this.fieldInfo).forEach(u=>{var l,m,f;(f=(m=(l=u.instance)==null?void 0:l.options.listeners)==null?void 0:m.onSubmit)==null||f.call(m,{value:u.instance.state.value,fieldApi:u.instance})})}),(o=(n=this.options.listeners)==null?void 0:n.onSubmit)==null||o.call(n,{formApi:this});try{await((c=(h=this.options).onSubmit)==null?void 0:c.call(h,{value:this.state.values,formApi:this,meta:a??this.options.onSubmitMeta})),k(()=>{this.baseStore.setState(u=>({...u,isSubmitted:!0,isSubmitSuccessful:!0})),d()})}catch(u){throw this.baseStore.setState(l=>({...l,isSubmitSuccessful:!1})),d(),u}}setErrorMap(a){k(()=>{Object.entries(a).forEach(([i,e])=>{const t=i;if(ee(e)){const{formError:s,fieldErrors:n}=R(e);for(const o of Object.keys(this.fieldInfo))this.getFieldMeta(o)&&this.setFieldMeta(o,c=>({...c,errorMap:{...c.errorMap,[t]:n?.[o]},errorSourceMap:{...c.errorSourceMap,[t]:"form"}}));this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[t]:s}}))}else this.baseStore.setState(s=>({...s,errorMap:{...s.errorMap,[t]:e}}))})})}}function R(r){if(r){if(ee(r)){const a=R(r.form).formError,i=r.fields;return{formError:a,fieldErrors:i}}return{formError:r}}return{formError:void 0}}function W(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class We{constructor(a){this.options={},this.mount=()=>{var i,e;const t=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const s=this.getInfo();s.instance=this,this.update(this.options);const{onMount:n}=this.options.validators||{};if(n){const o=this.runValidator({validate:n,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});o&&this.setMeta(h=>({...h,errorMap:{...h?.errorMap,onMount:o},errorSourceMap:{...h?.errorSourceMap,onMount:"field"}}))}return(e=(i=this.options.listeners)==null?void 0:i.onMount)==null||e.call(i,{value:this.state.value,fieldApi:this}),t},this.update=i=>{this.options=i;const e=this.name!==i.name;if(this.name=i.name,this.state.value===void 0){const t=C(i.form.options.defaultValues,i.name),s=i.defaultValue??t;e?this.setValue(n=>n||s,{dontUpdateMeta:!0}):s!==void 0&&this.setValue(s,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(i,e)=>{this.form.setFieldValue(this.name,i,e),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=i=>this.form.setFieldMeta(this.name,i),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(i,e)=>{this.form.pushFieldValue(this.name,i,e),this.triggerOnChangeListener()},this.insertValue=(i,e,t)=>{this.form.insertFieldValue(this.name,i,e,t),this.triggerOnChangeListener()},this.replaceValue=(i,e,t)=>{this.form.replaceFieldValue(this.name,i,e,t),this.triggerOnChangeListener()},this.removeValue=(i,e)=>{this.form.removeFieldValue(this.name,i,e),this.triggerOnChangeListener()},this.swapValues=(i,e,t)=>{this.form.swapFieldValues(this.name,i,e,t),this.triggerOnChangeListener()},this.moveValue=(i,e,t)=>{this.form.moveFieldValues(this.name,i,e,t),this.triggerOnChangeListener()},this.clearValues=i=>{this.form.clearFieldValues(this.name,i),this.triggerOnChangeListener()},this.getLinkedFields=i=>{const e=Object.values(this.form.fieldInfo),t=[];for(const s of e){if(!s.instance)continue;const{onChangeListenTo:n,onBlurListenTo:o}=s.instance.options.validators||{};i==="change"&&n?.includes(this.name)&&t.push(s.instance),i==="blur"&&o?.includes(this.name)&&t.push(s.instance)}return t},this.validateSync=(i,e)=>{var t;const s=Y(i,this.options),o=this.getLinkedFields(i).reduce((d,u)=>{const l=Y(i,u.options);return l.forEach(m=>{m.field=u}),d.concat(l)},[]);let h=!1;k(()=>{const d=(u,l)=>{var m;const f=z(l.cause),v=l.validate?he(u.runValidator({validate:l.validate,value:{value:u.store.state.value,validationSource:"field",fieldApi:u},type:"validate"})):void 0,p=e[f],{newErrorValue:g,newSource:b}=ce({formLevelError:p,fieldLevelError:v});((m=u.state.meta.errorMap)==null?void 0:m[f])!==g&&u.setMeta(y=>({...y,errorMap:{...y.errorMap,[f]:g},errorSourceMap:{...y.errorSourceMap,[f]:b}})),g&&(h=!0)};for(const u of s)d(this,u);for(const u of o)u.validate&&d(u.field,u)});const c=z("submit");return(t=this.state.meta.errorMap)!=null&&t[c]&&i!=="submit"&&!h&&this.setMeta(d=>({...d,errorMap:{...d.errorMap,[c]:void 0},errorSourceMap:{...d.errorSourceMap,[c]:void 0}})),{hasErrored:h}},this.validateAsync=async(i,e)=>{const t=X(i,this.options),s=await e,n=this.getLinkedFields(i),o=n.reduce((l,m)=>{const f=X(i,m.options);return f.forEach(v=>{v.field=m}),l.concat(f)},[]);this.state.meta.isValidating||this.setMeta(l=>({...l,isValidating:!0}));for(const l of n)l.setMeta(m=>({...m,isValidating:!0}));const h=[],c=[],d=(l,m,f)=>{const v=z(m.cause),p=l.getInfo().validationMetaMap[v];p?.lastAbortController.abort();const g=new AbortController;this.getInfo().validationMetaMap[v]={lastAbortController:g},f.push(new Promise(async b=>{var y;let E;try{E=await new Promise((S,O)=>{this.timeoutIds.validations[m.cause]&&clearTimeout(this.timeoutIds.validations[m.cause]),this.timeoutIds.validations[m.cause]=setTimeout(async()=>{if(g.signal.aborted)return S(void 0);try{S(await this.runValidator({validate:m.validate,value:{value:l.store.state.value,fieldApi:l,signal:g.signal,validationSource:"field"},type:"validateAsync"}))}catch(j){O(j)}},m.debounceMs)})}catch(S){E=S}if(g.signal.aborted)return b(void 0);const x=he(E),w=(y=s[this.name])==null?void 0:y[v],{newErrorValue:A,newSource:_}=ce({formLevelError:w,fieldLevelError:x});l.setMeta(S=>({...S,errorMap:{...S?.errorMap,[v]:A},errorSourceMap:{...S.errorSourceMap,[v]:_}})),b(A)}))};for(const l of t)l.validate&&d(this,l,h);for(const l of o)l.validate&&d(l.field,l,c);let u=[];(h.length||c.length)&&(u=await Promise.all(h),await Promise.all(c)),this.setMeta(l=>({...l,isValidating:!1}));for(const l of n)l.setMeta(m=>({...m,isValidating:!1}));return u.filter(Boolean)},this.validate=(i,e)=>{var t;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=e?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(i),{hasErrored:n}=this.validateSync(i,s[this.name]??{});if(n&&!this.options.asyncAlways)return(t=this.getInfo().validationMetaMap[z(i)])==null||t.lastAbortController.abort(),this.state.meta.errors;const o=e?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(i);return this.validateAsync(i,o)},this.handleChange=i=>{this.setValue(i)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(e=>({...e,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(e=>({...e,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=i=>D.validate({value:this.state.value,validationSource:"field"},i),this.parseValueWithSchemaAsync=i=>D.validateAsync({value:this.state.value,validationSource:"field"},i),this.form=a.form,this.name=a.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new J({deps:[this.form.store],fn:()=>{const i=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{...K,...a.defaultMeta};return{value:i,meta:e}}}),this.options=a}get state(){return this.store.state}runValidator(a){return me(a.validate)?D[a.type](a.value,a.validate):a.validate(a.value)}setErrorMap(a){this.setMeta(i=>({...i,errorMap:{...i.errorMap,...a}}))}triggerOnBlurListener(){var a,i,e,t,s,n;const o=(a=this.form.options.listeners)==null?void 0:a.onBlurDebounceMs;o&&o>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var c,d;(d=(c=this.form.options.listeners)==null?void 0:c.onBlur)==null||d.call(c,{formApi:this.form,fieldApi:this})},o)):(e=(i=this.form.options.listeners)==null?void 0:i.onBlur)==null||e.call(i,{formApi:this.form,fieldApi:this});const h=(t=this.options.listeners)==null?void 0:t.onBlurDebounceMs;h&&h>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var c,d;(d=(c=this.options.listeners)==null?void 0:c.onBlur)==null||d.call(c,{value:this.state.value,fieldApi:this})},h)):(n=(s=this.options.listeners)==null?void 0:s.onBlur)==null||n.call(s,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var a,i,e,t,s,n;const o=(a=this.form.options.listeners)==null?void 0:a.onChangeDebounceMs;o&&o>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{var c,d;(d=(c=this.form.options.listeners)==null?void 0:c.onChange)==null||d.call(c,{formApi:this.form,fieldApi:this})},o)):(e=(i=this.form.options.listeners)==null?void 0:i.onChange)==null||e.call(i,{formApi:this.form,fieldApi:this});const h=(t=this.options.listeners)==null?void 0:t.onChangeDebounceMs;h&&h>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var c,d;(d=(c=this.options.listeners)==null?void 0:c.onChange)==null||d.call(c,{value:this.state.value,fieldApi:this})},h)):(n=(s=this.options.listeners)==null?void 0:s.onChange)==null||n.call(s,{value:this.state.value,fieldApi:this})}}function he(r){if(r)return r}function z(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}const U=typeof window<"u"?F.useLayoutEffect:F.useEffect;function ze(r){const[a]=F.useState(()=>{const e=new We({...r,form:r.form,name:r.name});return e.Field=ve,e});return U(a.mount,[a]),U(()=>{a.update(r)}),te(a.store,r.mode==="array"?i=>[i.meta,Object.keys(i.value??[]).length]:void 0),a}const ve=({children:r,...a})=>{const i=ze(a),e=F.useMemo(()=>H(r,i),[r,i,i.state.value,i.state.meta]);return I.jsx(I.Fragment,{children:e})};function Re({form:r,selector:a,children:i}){const e=te(r.store,a);return H(i,e)}function Ke(r){const[a]=F.useState(()=>{const i=new Le(r),e=i;return e.Field=function(s){return I.jsx(ve,{...s,form:i})},e.Subscribe=t=>I.jsx(Re,{form:i,selector:t.selector,children:t.children}),e});return U(a.mount,[]),te(a.store,i=>i.isSubmitting),U(()=>{a.update(r)}),a}const Ge=function(){const a=Me(),i=Ke({defaultValues:{title:"",amount:0},onSubmit:async({value:e})=>{if(!(await ye.expenses.create.$post({json:{id:Date.now(),...e}})).ok)throw new Error("Failed to create expense");a({to:"/expenses"}),console.log(e)}});return V.jsxDEV("div",{className:"flex flex-col items-center justify-center h-screen",children:[V.jsxDEV("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),i.handleSubmit()},className:"flex flex-col gap-4 w-96 bg-zinc-700 p-6 rounded-lg shadow-md",children:[V.jsxDEV("div",{children:V.jsxDEV(i.Field,{name:"title",children:e=>V.jsxDEV(V.Fragment,{children:[V.jsxDEV("label",{htmlFor:e.name,children:"Title"},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:43,columnNumber:19},this),V.jsxDEV(oe,{id:e.name,name:e.name,value:e.state.value,onBlur:e.handleBlur,onChange:t=>{const s=t.target.value.replace(/^0+(?=\d)/,"");e.handleChange(s)}},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:44,columnNumber:19},this),V.jsxDEV(le,{field:e},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:48,columnNumber:19},this)]},void 0,!0,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:42,columnNumber:18},this)},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:41,columnNumber:11},this)},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:40,columnNumber:9},this),V.jsxDEV("div",{children:V.jsxDEV(i.Field,{name:"amount",children:e=>V.jsxDEV(V.Fragment,{children:[V.jsxDEV("label",{htmlFor:e.name,children:"Amount"},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:55,columnNumber:19},this),V.jsxDEV(oe,{id:e.name,name:e.name,value:e.state.value,onBlur:e.handleBlur,type:"number",onChange:t=>e.handleChange(+t.target.value)},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:56,columnNumber:19},this),V.jsxDEV(le,{field:e},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:57,columnNumber:19},this)]},void 0,!0,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:54,columnNumber:18},this)},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:53,columnNumber:11},this)},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:52,columnNumber:9},this),V.jsxDEV("div",{children:V.jsxDEV(i.Subscribe,{selector:e=>[e.canSubmit,e.isSubmitting],children:([e,t])=>V.jsxDEV(Te,{className:"w-full bg-white text-zinc-700 hover:bg-gray-200 uppercase font-bold",type:"submit",disabled:!e,children:t?"...":"Submit"},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:62,columnNumber:126},this)},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:62,columnNumber:11},this)},void 0,!1,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:61,columnNumber:9},this)]},void 0,!0,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:35,columnNumber:7},this)," "]},void 0,!0,{fileName:"/home/shivang/code/ExpenseTracker/client/src/routes/create-expense.tsx?tsr-split=component",lineNumber:34,columnNumber:10},this)};export{Ge as component};
